"use strict";(self.webpackChunkdocs_contracts=self.webpackChunkdocs_contracts||[]).push([[747],{3905:(t,e,n)=>{n.d(e,{Zo:()=>c,kt:()=>f});var a=n(7294);function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e){if(null==t)return{};var n,a,o=function(t,e){if(null==t)return{};var n,a,o={},r=Object.keys(t);for(a=0;a<r.length;a++)n=r[a],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(a=0;a<r.length;a++)n=r[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var d=a.createContext({}),s=function(t){var e=a.useContext(d),n=e;return t&&(n="function"==typeof t?t(e):i(i({},e),t)),n},c=function(t){var e=s(t.components);return a.createElement(d.Provider,{value:e},t.children)},m="mdxType",p={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},u=a.forwardRef((function(t,e){var n=t.components,o=t.mdxType,r=t.originalType,d=t.parentName,c=l(t,["components","mdxType","originalType","parentName"]),m=s(n),u=o,f=m["".concat(d,".").concat(u)]||m[u]||p[u]||r;return n?a.createElement(f,i(i({ref:e},c),{},{components:n})):a.createElement(f,i({ref:e},c))}));function f(t,e){var n=arguments,o=e&&e.mdxType;if("string"==typeof t||o){var r=n.length,i=new Array(r);i[0]=u;var l={};for(var d in e)hasOwnProperty.call(e,d)&&(l[d]=e[d]);l.originalType=t,l[m]="string"==typeof t?t:o,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3384:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var a=n(7462),o=(n(7294),n(3905));const r={sidebar_position:1},i="Jetton Master",l={unversionedId:"jetton/JettonMaster",id:"jetton/JettonMaster",title:"Jetton Master",description:"This Jetton Master smart contract provides a framework for Jetton Master that comply with the TEP-0074 standard.",source:"@site/docs/jetton/JettonMaster.md",sourceDirName:"jetton",slug:"/jetton/JettonMaster",permalink:"/docs.contracts/docs/jetton/JettonMaster",draft:!1,editUrl:"https://github.com/Ton-Dynasty/tondynasty-contracts/pulls/docs/jetton/JettonMaster.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Tutorial - Jetton",permalink:"/docs.contracts/docs/category/tutorial---jetton"},next:{title:"Jetton Wallet",permalink:"/docs.contracts/docs/jetton/JettonWallet"}},d={},s=[{value:"Overview",id:"overview",level:2},{value:"Our Trait",id:"our-trait",level:2},{value:"Message Types",id:"message-types",level:3},{value:"<code>JettonMint</code>:",id:"jettonmint",level:4},{value:"Must Override Functions",id:"must-override-functions",level:3},{value:"<code>calculate_jetton_wallet_init(owner_address: Address)</code>:",id:"calculate_jetton_wallet_initowner_address-address",level:4},{value:"Optional Override Functions",id:"optional-override-functions",level:3},{value:"<code>_mint_validate(ctx: Context, msg: JettonMint)</code>:",id:"_mint_validatectx-context-msg-jettonmint",level:4},{value:"<code>_mint(ctx: Context, msg: JettonMint)</code>:",id:"_mintctx-context-msg-jettonmint",level:4},{value:"<code>_burn_notification_validate(ctx: Context, msg: JettonBurnNotification)</code>:",id:"_burn_notification_validatectx-context-msg-jettonburnnotification",level:4},{value:"How to use",id:"how-to-use",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Advanced Usage",id:"advanced-usage",level:3}],c={toc:s},m="wrapper";function p(t){let{components:e,...n}=t;return(0,o.kt)(m,(0,a.Z)({},c,n,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"jetton-master"},"Jetton Master"),(0,o.kt)("p",null,"This Jetton Master smart contract provides a framework for Jetton Master that comply with the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ton-blockchain/TEPs/blob/master/text/0074-jettons-standard.md"},"TEP-0074")," standard."),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"In TEP-0074, each Jetton has a corresponding Jetton Master contract, which stores the basic information of the Jetton, including the total supply, the link to the metadata, the metadata itself, etc., and is used to mint the Jetton."),(0,o.kt)("p",null,"If you need to get the information of the entire Jetton, you can get it through the ",(0,o.kt)("inlineCode",{parentName:"p"},"get_jetton_data()")," of the Jetton Master."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"struct JettonData {\n    total_supply: Int as coins; // the total number of issues jettons\n    mintable: Bool;             // flag which indicates whether number of jettons can increase admin_address\n    admin_address: Address;     // address of smart-contrac which control Jetton\n    jetton_content: Cell;       // data in accordance to Token Data Standard #64\n    jetton_wallet_code: Cell;   // code of wallet for that jetton\n}\n\n// @dev get_jetton_data retrieve information of this jetton\nget fun get_jetton_data(): JettonData {\n    return JettonData{\n        total_supply: self.total_supply,\n        mintable: self.mintable,\n        admin_address: self.owner,\n        jetton_content: self.jetton_content,\n        jetton_wallet_code: self.calculate_jetton_wallet_init(myAddress()).code\n    };\n}\n")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"total_supply")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"int")),(0,o.kt)("td",{parentName:"tr",align:null},"the total number of issued jettons measured in indivisible units.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"mintable")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"int")),(0,o.kt)("td",{parentName:"tr",align:null},"details whether new jettons can be minted or not. This value is either -1 (can be minted) or 0 (cannot be minted).")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"admin_address")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"slice")),(0,o.kt)("td",{parentName:"tr",align:null})),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"jetton_content")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"cell")),(0,o.kt)("td",{parentName:"tr",align:null},"data in accordance with ",(0,o.kt)("a",{parentName:"td",href:"https://github.com/ton-blockchain/TEPs/blob/master/text/0064-token-data-standard.md"},"TEP-64"),".")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"jetton_wallet_code")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"cell")),(0,o.kt)("td",{parentName:"tr",align:null},"code of wallet for that jetton")))),(0,o.kt)("h2",{id:"our-trait"},"Our Trait"),(0,o.kt)("h3",{id:"message-types"},"Message Types"),(0,o.kt)("p",null,"For Jetton Master, we define the ",(0,o.kt)("inlineCode",{parentName:"p"},"JettonMint")," message type for minting Jetton."),(0,o.kt)("h4",{id:"jettonmint"},(0,o.kt)("inlineCode",{parentName:"h4"},"JettonMint"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"message JettonMint {\n    origin: Address;        // address of origin mint request (may be wallet v4)\n    receiver: Address;      // address of receiver\n    amount: Int;            // amount of jettons to mint\n    custom_payload: Cell?;  // optional custom data\n    forward_ton_amount: Int as coins;\n    forward_payload: Slice as remaining;\n}\n")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Name"),(0,o.kt)("th",{parentName:"tr",align:null},"Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"origin")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"slice")),(0,o.kt)("td",{parentName:"tr",align:null},"address of origin mint request (may be wallet v4)")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"receiver")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"slice")),(0,o.kt)("td",{parentName:"tr",align:null},"address of receiver")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"amount")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"int")),(0,o.kt)("td",{parentName:"tr",align:null},"amount of jettons to mint")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"custom_payload")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"cell")),(0,o.kt)("td",{parentName:"tr",align:null},"optional custom data")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"forward_ton_amount")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"int")),(0,o.kt)("td",{parentName:"tr",align:null})),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"forward_payload")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"slice")),(0,o.kt)("td",{parentName:"tr",align:null})))),(0,o.kt)("h3",{id:"must-override-functions"},"Must Override Functions"),(0,o.kt)("p",null,"Jetton Master defines the following ",(0,o.kt)("strong",{parentName:"p"},"MUST")," override functions:"),(0,o.kt)("h4",{id:"calculate_jetton_wallet_initowner_address-address"},(0,o.kt)("inlineCode",{parentName:"h4"},"calculate_jetton_wallet_init(owner_address: Address)"),":"),(0,o.kt)("p",null,"Calculate Jetton Wallet's StateInit by Jetton Wallet's ",(0,o.kt)("strong",{parentName:"p"},"owner address"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"// @dev  calculate_jetton_wallet_init retrieve init code of a jetton wallet\n// @note one MUST override this function in inherited contract\nabstract inline fun calculate_jetton_wallet_init(owner_address: Address): StateInit;\n")),(0,o.kt)("h3",{id:"optional-override-functions"},"Optional Override Functions"),(0,o.kt)("p",null,"Jetton Master defines the following ",(0,o.kt)("strong",{parentName:"p"},"Optional")," override functions:"),(0,o.kt)("h4",{id:"_mint_validatectx-context-msg-jettonmint"},(0,o.kt)("inlineCode",{parentName:"h4"},"_mint_validate(ctx: Context, msg: JettonMint)"),":"),(0,o.kt)("p",null,"Check if the mint request is valid. For example, check if the sender of the mint request is the owner of the Jetton Master, and if the Jetton can be minted."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// @dev  _mint_validate conduct some custom validating before mint\nvirtual inline fun _mint_validate(ctx: Context, msg: JettonMint) {\n    require(ctx.sender == self.owner, "JettonMaster: Sender is not a Jetton owner");\n    require(self.mintable, "JettonMaster: Jetton is not mintable");\n}\n')),(0,o.kt)("h4",{id:"_mintctx-context-msg-jettonmint"},(0,o.kt)("inlineCode",{parentName:"h4"},"_mint(ctx: Context, msg: JettonMint)"),":"),(0,o.kt)("p",null,"Mint Jetton and send ",(0,o.kt)("a",{parentName:"p",href:"JettonWallet"},"Jetton Wallet"),"'s init code, init data and mint information to Jetton Wallet."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"// @dev  _mint mint jettons\nvirtual inline fun _mint(ctx: Context, msg: JettonMint) {\n    let initCode: StateInit = self.calculate_jetton_wallet_init(msg.receiver);\n    self.total_supply = self.total_supply + msg.amount;\n    send(SendParameters{\n        to: contractAddress(initCode),\n        value: 0,\n        bounce: true,\n        mode: SendRemainingValue,\n        body: JettonInternalTransfer{\n            query_id: 0,\n            amount: msg.amount,\n            response_address: msg.origin,\n            from: myAddress(),\n            forward_ton_amount: msg.forward_ton_amount,\n            forward_payload: msg.forward_payload\n        }.toCell(),\n        code: initCode.code,\n        data: initCode.data\n    });\n}\n")),(0,o.kt)("h4",{id:"_burn_notification_validatectx-context-msg-jettonburnnotification"},(0,o.kt)("inlineCode",{parentName:"h4"},"_burn_notification_validate(ctx: Context, msg: JettonBurnNotification)"),":"),(0,o.kt)("p",null,"Check if the burn request is valid. For example, check if the sender of the burn request is a Jetton Wallet."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'// @dev  _burn_notification_validate perform some custom validation after receiving JettonBurnNotification sent from Jetton wallet\nvirtual inline fun _burn_notification_validate(ctx: Context, msg: JettonBurnNotification) {\n    let initCode: StateInit = self.calculate_jetton_wallet_init(msg.sender);\n    require(ctx.sender == contractAddress(initCode), "Sender is not a Jetton wallet");\n}\n')),(0,o.kt)("h2",{id:"how-to-use"},"How to use"),(0,o.kt)("h3",{id:"basic-usage"},"Basic Usage"),(0,o.kt)("p",null,"To use our Jetton Master Trait, you need to implement a Jetton Master contract and a ",(0,o.kt)("a",{parentName:"p",href:"JettonWallet"},"Jetton Wallet contract"),", and implement ",(0,o.kt)("inlineCode",{parentName:"p"},"calculate_jetton_wallet_init(owner_address: Address)")," and other must override functions and init function, for example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'import "@stdlib/deploy";\nimport "./packages/token/jetton/JettonMaster";\nimport "./packages/token/jetton/JettonWallet";\n\ncontract ExampleJettonWallet with JettonWallet {\n    balance: Int as coins = 0;\n    owner: Address;\n    jetton_master: Address;\n\n    init(owner: Address, jetton_master: Address) {\n        self.owner = owner;\n        self.jetton_master = jetton_master;\n    }\n\n    override inline fun calculate_jetton_wallet_init(owner_address: Address): StateInit {\n        return initOf ExampleJettonWallet(owner_address, self.jetton_master);\n    }\n}\n\ncontract ExampleJettonMaster with JettonMaster, Deployable {\n    total_supply: Int as coins = 0;\n    mintable: Bool = true;\n    owner: Address;\n    jetton_content: Cell;\n\n    init(owner: Address, jetton_content: Cell){\n        self.owner = owner;\n        self.jetton_content = jetton_content;\n    }\n    override inline fun calculate_jetton_wallet_init(owner_address: Address): StateInit {\n        return initOf ExampleJettonWallet(owner_address, myAddress());\n    }\n}\n')),(0,o.kt)("h3",{id:"advanced-usage"},"Advanced Usage"),(0,o.kt)("p",null,"If you need to customize the behavior of Jetton Master, you can override the optional override function of Jetton Master and add various functions. For example, if we want to check if the Jetton can be minted when minting Jetton, we can override ",(0,o.kt)("inlineCode",{parentName:"p"},"_mint_validate(ctx: Context, msg: JettonMint)"),', or if we want to let the User send "Mint:1" directly to the Jetton Master to mint Jetton, we can add a ',(0,o.kt)("inlineCode",{parentName:"p"},'receive("Mint:1")')," function, for example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},'receive("Mint:1") {\n    let ctx: Context = context();\n    let msg: JettonMint = JettonMint{\n        origin: ctx.sender,\n        receiver: ctx.sender,\n        amount: ton("1"),\n        custom_payload: emptyCell(),\n        forward_ton_amount: 0,\n        forward_payload: emptySlice()\n    };\n    self._mint_validate(ctx, msg);\n    self._mint(ctx, msg);\n}\n\noverride inline fun _mint_validate(ctx: Context, msg: JettonMint) {\n    require(self.mintable, "JettonMaster: Jetton is not mintable");\n}\n')))}p.isMDXComponent=!0}}]);